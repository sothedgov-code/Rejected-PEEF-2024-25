<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PEEF</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      position: relative;
    }
    h2 {
      text-align: center;
      color: purple;
      margin-bottom: 15px;
    }
    #searchBox {
      display: block;
      margin: 0 auto 10px auto;
      width: 60%;
      padding: 8px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    #suggestions {
      width: 60%;
      margin: 0 auto 15px auto;
      border: 1px solid #ccc;
      border-top: none;
      border-radius: 0 0 4px 4px;
      background: white;
      display: none;
      position: relative;
      z-index: 10;
      max-height: 200px;
      overflow-y: auto;
    }
    #suggestions div {
      padding: 8px;
      cursor: pointer;
    }
    #suggestions div:hover {
      background: #f0f0f0;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      font-size: 14px;
      margin-top: 20px;
      position: relative;
      z-index: 1;
    }
    th, td {
      border: 1px solid #000;
      padding: 6px;
      text-align: left;
    }
    thead {
      background-color: #e3f2fd;
    }
    #watermark {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      background-image: repeating-linear-gradient(
        rgba(128, 0, 128, 0.08) 0,
        rgba(128, 0, 128, 0.08) 1px,
        transparent 1px,
        transparent 200px
      );
    }
    #watermark::before {
      content: "Confidential â€¢ For PEEF Students Only";
      position: absolute;
      top: 25%;
      left: 50%;
      transform: translate(-50%, -50%) rotate(-30deg);
      font-size: 30px;
      color: rgba(128, 0, 128, 0.15);
      white-space: nowrap;
    }
  </style>
</head>
<body>
  <h2>Rejected PEEF Applications 2024-25</h2>

  <input type="text" id="searchBox" placeholder="Type Student Name, Father Name, or Marks...">
  <div id="suggestions"></div>

  <div id="watermark"></div>

  <table id="dataTable">
    <thead>
      <tr>
        <th>Serial</th>
        <th>Student Name</th>
        <th>Father Name</th>
        <th>Address</th>
        <th>Remarks</th>
        <th>Marks</th>
        <th>Class</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>

  <script>
    document.addEventListener('contextmenu', e => e.preventDefault());
    document.addEventListener('copy', e => e.preventDefault());
    document.addEventListener('cut', e => e.preventDefault());
    document.addEventListener('selectstart', e => e.preventDefault());

    const searchBox = document.getElementById('searchBox');
    const suggestions = document.getElementById('suggestions');
    const tableBody = document.getElementById('tableBody');
    let allRows = [];
    let searchableValues = [];
    let hideTimer;

    let data = [];
    fetch('data.csv')
      .then(response => response.text())
      .then(text => {
        const lines = text.trim().split('\n');
        for (let i = 1; i < lines.length; i++) {
          const [serial, student, father, address, remarks, marks, className] = lines[i].split(',');
          data.push({ serial, student, father, address, remarks, marks, className });
        }

        tableBody.innerHTML = data.map(item => `
          <tr>
            <td>${item.serial}</td>
            <td>${item.student}</td>
            <td>${item.father}</td>
            <td>${item.address}</td>
            <td>${item.remarks}</td>
            <td>${item.marks}</td>
            <td>${item.className}</td>
          </tr>
        `).join('');

        allRows = Array.from(document.querySelectorAll('#dataTable tbody tr'));
        searchableValues = Array.from(new Set(
          allRows.flatMap(row => [
            row.cells[1].textContent.trim(),
            row.cells[2].textContent.trim(),
            row.cells[5].textContent.trim()
          ])
        ));
        allRows.forEach(row => row.style.display = 'none');
      });

    searchBox.addEventListener('input', () => {
      const query = searchBox.value.trim().toLowerCase();
      suggestions.innerHTML = '';
      suggestions.style.display = 'none';
      // hide all rows until a suggestion is clicked
      allRows.forEach(row => row.style.display = 'none');

      if (!query) return;

      const matchedValues = searchableValues.filter(v => v.toLowerCase().includes(query));
      if (matchedValues.length > 0) {
        suggestions.style.display = 'block';
        matchedValues.forEach(value => {
          const item = document.createElement('div');
          item.textContent = value;
          item.addEventListener('click', () => {
            searchBox.value = value;
            suggestions.style.display = 'none';
            showMatchedRows(value.toLowerCase());
            resetAutoHide();
          });
          suggestions.appendChild(item);
        });
      }
    });

    function showMatchedRows(query) {
      allRows.forEach(row => {
        const student = row.cells[1].textContent.toLowerCase();
        const father = row.cells[2].textContent.toLowerCase();
        const marks = row.cells[5].textContent.toLowerCase();
        row.style.display = (student.includes(query) || father.includes(query) || marks.includes(query)) ? '' : 'none';
      });
    }

    function resetAutoHide() {
      clearTimeout(hideTimer);
      hideTimer = setTimeout(() => {
        allRows.forEach(row => row.style.display = 'none');
        searchBox.value = '';
      }, 10000);
    }

    document.addEventListener('click', e => {
      if (e.target !== searchBox && e.target.parentNode !== suggestions)
        suggestions.style.display = 'none';
    });
  </script>
</body>
</html>
